<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout1}">
	
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3.0">
  <title>프로그램 신청/수정 페이지(Board)</title>
  <link rel="stylesheet" th:href="@{/css/applyForm.css}">
  <link rel="stylesheet" th:href="@{/css/header.css}">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

</head>

<!-- 사용자 스크립트 추가 -->
<th:block layout:fragment="script">
	<script th:Inline="javascript">
    $(document).ready(function() {
    	var errorMessage = [[${errorMessage}]];   <!--상품등록 시 실패 메시지를 받아서 상품등록 재진입 시 alert를 통해서 실패 사유를 보여준다.-->
    	if(errorMessage != null) {
    	alert(errorMessage);
    }
    
    bindDomEvent();
    
    });
    
    function bindDomEvent() {
    	$(".custom-file-input").on("change", function() {
    			var fileName = $(this).val().split("\\").pop();   // 이미지 파일명
    	        var fileExt = fileName.substring(fileName.lastIndexOf(".") + 1);   // 확장자 추출
    	        fileExt = fileExt.toLowerCase();   // 소문자 변환(이미지 확장자를 소문자로 통일하여 비교하기 위함)
    	        
    	        if(fileExt != "jpg" && fileExt != "jpeg" && fileExt != "gif" && fileExt != "png" && fileExt != "bmp"){
    	        	alert("이미지 파일만 등록이 가능합니다."); <!-- 파일첨부 시 이미지 파일인지 검사한다. -->
    	        	return;
    	        }
    	        
    	        /* $(this).siblings(".upload-name").html(fileName); <!-- 라벨 태그 안의 내용을 jquery의 .html()을 이용하여 파일명을 입력해준다. --> */
    	        $(this).siblings(".upload-name").val(fileName); <!-- 라벨 태그 안의 내용을 jquery의 .html()을 이용하여 파일명을 입력해준다. -->
    	});
    }
    
    $("#select-programCategory").change(function() {
		let category = $("#select-programCategory option:selected").val();
		if(category == "공연") {
			$("#select-seat").show(); //카테고리 선택시 검색어입력창 숨기기
		}else {
			$("#select-seat").hide();
		}
	});
    
    /* $(function(){	
    	$(document).on("change", "select[name=select-programCategory]", function(){
    		var value = $(this).find("option:selected").val();
    		var inputseat = $(this).closest('.selectBox').find('.inputText');
    		var flag = false;
    		if (value == 0) {
    			flag = true;
    			$(inputText).val('');
    		}
    		
    		$(inputText).attr("disabled", flag);
    	});

    }) */

    
  </script>
</th:block>

<body>

<div layout:fragment="content">

  <article class="board">
    <h1>Program Apply</h1>
    <section class="contents">
    <form class="application-txt" name="applicationForm" role="form" method="post" enctype="multipart/form-data"
		th:object="${applicationDto}">
      <h4>프로그램 신청</h4>
      <input type="hidden" th:field="*{num}">
      <div class="inner">

		<span class="input-group-text">카테고리</span>
        <select class="applyForm-input" name="select-programCategory" th:onchange="onchangeProgramCategory(this.value)" th:field="*{programCategory}">
          <option value="공연">공연</option>
          <option value="전시">전시</option>
          <option value="행사">행사</option>
        </select><br><br>
        
        
        <span class="input-group-text">장소</span>
        <select class="applyForm-input" name="select" th:field="*{place}">
          <option th:value="태기관">태기관</option>
          <option th:value="원석원석관">원석원석관</option>
          <option th:value="지영영관">지영영관</option>
        </select><br>
        
        <div class=inputseat>
        <span class="input-group-text">좌석</span>
        <select class="applyForm-input" id="select-seat" name="select" th:field="*{seatDetail}">
          <option th:value="null">좌석정보를 입력해주세요.</option>
          <option th:value="A">A</option>
          <option th:value="B">B</option>
          <option th:value="C">C</option>
        </select></div><br><br>

          <span class="input-group-text">프로그램명</span>
          <input type="text" th:field="*{name}" name="title" class="applyForm-input" placeholder="프로그램명을 입력하세요."><br>
          
          <span class="input-group-text">가격</span><br>
          <input type="number" th:field="*{price}" name="price" class="applyForm-input" placeholder="프로그램 가격을 입력하세요."><br>
          
          <span class="input-group-text">관람등급</span><br>
          <input type="text" th:field="*{rat}" name="rat" class="applyForm-input" placeholder="프로그램의 관람등급을 입력하세요."><br><br>
          
          <span class="input-group-text">프로그램 기간</span><br>
          <input type="date" aria-required="true" th:field="*{sdate}" name="sdate" class="applyForm-input" placeholder="프로그램 시작일을 입력하세요.(yyyy-mm-dd)">
          <input type="date" th:field="*{edate}" name="edate" class="applyForm-input" placeholder="프로그램 종료일을 입력하세요.(yyyy-mm-dd)"><br><br>
          
          <span class="input-group-text">관람시간</span><br>
          <input type="number" th:field="*{run}" name="run" class="applyForm-input" placeholder="프로그램 관람시간을 입력하세요."><br><br>
          
          <span class="input-group-text">상세정보</span>
          <textarea th:field="*{detail}" name="content" id="textarea" placeholder="프로그램 상세정보를 입력하세요."></textarea><br><br>
          
          <!-- <div th:if="${#lists.isEmpty(applicationDto.attachDtoList)}">
		  	<div class="file" th:each="numb: ${#numbers.sequence(1,5)}">
            	<div class="custom-file">
        			<label for="file1" th:text="프로그램이미지 + ${numb}"></label>
        			<input type="file" class="custom-file-input" name="attachFile" id="picture">
      			</div>
    		</div>
  		</div> -->
          
        <span class="input-group-text">첨부파일</span>
        <div class="filebox" th:if="${#lists.isEmpty(applicationDto.attachDtoList)}">
        	<div class="file" th:each="numb: ${#numbers.sequence(1,5)}">
    			<input class="upload-name" value="첨부파일" placeholder="첨부파일" />
   				<label th:for="file + ${numb}" class="custom-file-label" th:text="파일찾기"></label> 
    			<input type="file" class="custom-file-input" name="attachFile" th:id="file + ${numb}" />
			</div>
		</div>
		
		<div class="filebox" th:if="${not #lists.isEmpty(applicationDto.attachDtoList)}">
        	<div class="file" th:each="attachDto, status: ${applicationDto.attachDtoList}">
        		<input type="hidden" name="attachIds" th:value="${attachDto.num}">
    			<input class="upload-name" th:value="${not #strings.isEmpty(attachDto.oriName)} ? ${attachDto.oriName} : '프로그램이미지' + ${status.index+1}" placeholder="첨부파일" />
   				<label th:for="file + ${status.index+1}" class="custom-file-label" th:text="파일찾기"></label> 
    			<input type="file" class="custom-file-input" name="attachFile" th:id="file + ${status.index+1}" />
			</div>
		</div>
          
          
          
          

          <!-- <div th:if="${#lists.isEmpty(applicationDto.attachDtoList)}" >
            <div class="file" th:each="numb: ${#numbers.sequence(1,5)}">
            <div class="cusfile">
            	<input id="picture" type="file" name="attachFile"/>
            	<label for="picture"><div class="btn-upload">+</div></label>
            </div>
            </div>
          </div> -->

          <!-- <div th:if = "${not #lists.isEmpty(applicationDto.attachDtoList)}">
            <div class="file" th:each="attachDto, status: ${applicationDto.attachDtoList}">
              <label for="picture"><div class="btn-upload">+</div></label>
              <input type="file" name="attachFile" id="picture" th:value="${attachDto.num}"/>
            </div>
          </div> -->
<!-- </div>
        </form> -->
        <div class="btn" th:if="${#strings.isEmpty(applicationDto.num)}" style="text-align: center">
          <button th:formaction="@{/board/program/apply}" type="submit" name="sign">신청</button>
        </div>
        <div class="btn" th:unless="${#strings.isEmpty(applicationDto.num)}" style="text-align: center">
    		  <button th:formaction="@{'/board/program/apply/' + ${applicationDto.num}}" type="submit" name="sign">수정</button>
  		</div>
      </div>
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
        </form>
    </section>
  </article>


</div>
</body>
</html>