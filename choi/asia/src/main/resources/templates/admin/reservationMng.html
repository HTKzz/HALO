<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	layout:decorate="~{layouts/layout1}">

<meta charset="UTF-8">

<head>
<link th:href="@{/css/vocList.css}" rel="stylesheet">
</head>


<th:block layout:fragment="script">
	<script th:inline="javascript">
		$(document).ready(function() {

			$("#refundMsg").on("click", function() {
				if (confirm('환불 완료 상태로 변경 하시겠습니까?')) {

				} else {
					return false;
				}
			});
			$("#reservation-cancelMsg").on("click", function() {
				if (confirm('취소 상태로 변경 하시겠습니까?')) {

				} else {
					return false;
				}
			});

			/* $("#searchBtn").on("click", function(e) {
			    e.preventDefault();
			    page(0);
			}); */
		});
		/* function page(page) {
		    /* var searchDateType = $("#searchDateType").val();
		    var stat = $("#stat").val();
		    var searchBy = $("#searchBy").val();
		    var searchQuery = $("#searchQuery").val(); 
		    location.href = "/admin/reservationMng/" + page + "?searchDateType=" +
		        searchDateType + "&stat=" + stat +
		        "&searchBy=" + searchBy + "&searchQuery=" + searchQuery
		} */
	</script>
</th:block>

<div layout:fragment="content">

	<div class="vocList-container">
		<div class="vocList-title">
			<h3>예매관리</h3>
		</div>
		<form class="memberMngForm" role="form" method="post" action="/admin/searchMember">
			<div class="vocList-searchOptions">
				<span class="vocList-searchOption-list"> <select
					th:name="searchOption" class="memberMng-select">
						<option th:value="id">아이디
				</select>
				</span> <span class="vocList-searchOption-list"> <input
					class="memberMng-select-search" name="memberMngSearch" type="text">
				</span> <span class="vocList-searchOption-list">
					<button class="memberMng-search-btn" type="submit">검색</button>
				</span>
			</div>
			<input type="hidden" th:name="${_csrf.parameterName}"
				th:value="${_csrf.token}">
		</form>

		<section class="vocList">
			<table class="vocList-table">
				<thead>
					<tr class="voc-tr">
						<td class="vocList-num">예매번호</td>
						<td class="vocList-name">상품명</td>
						<td class="vocList-rdate">예매일</td>
						<td class="vocList-udate">공연일</td>
						<td class="vocList-memberNum">예매자</td>
						<td class="vocList-stat">상태</td>
						<td class="vocList-stat" style="width: 70px;">
							<a class="vocList-stat" style="cursor:pointer;" onclick="window.open('https://classic-admin.portone.io/users/login')" >환불 페이지</a>
						</td>
					</tr>
				</thead>
				<tbody>
					<tr th:each="reservation : ${reservations}">
						<td class="vocList-num" th:text="${reservation.num}"></td>
						<td class="vocList-name" th:text="${reservation.application.name}"></td>
						<td class="vocList-rdate" th:text="${reservation.rdate}"></td>
						<td class="vocList-udate" th:text="${reservation.application.udate}"></td>
						<td class="vocList-memberNum" th:text="${reservation.member.id}"></td>
						<td class="vocList-stat" th:text="${reservation.stat}"></td>
						<td style="width:65px; padding-top:14px; padding-bottom:14px;">
							<form th:if="${reservation.stat == '환불대기'}" method="post" th:action="@{/admin/refundComplete/{num}(num=${reservation.num})}" id="frm">
								<button id="refundMsg">환불완료</button>
								<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
							</form>
						</td>
						<td style="width:60px;" class="myReservationForm-stat reservation-td">
                           	<form th:if="${reservation.stat != '취소'} and ${reservation.stat == '결제대기'}" method="post" onsubmit=true>
                           		<button th:formaction="@{/admin/adminCancelReservation/{num}(num=${reservation.num})}" id="reservation-cancelMsg"
                           				class="myReservationForm-btn">취소</button>
                           		<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                           	</form>
                        </td>
					</tr>
				</tbody>
			</table>
			<br>
			<div class="page_wrap">

				<ul class="pagination justify-content-center">

					<li class="page-item"
						th:classappend="${startPage == reservations.pageable.pageNumber + 1} ? 'disabled'">
						<a class="page-link"
						th:href="@{/admin/reservationMng(page=${reservations.pageable.pageNumber - 1})}"
						tabindex="-1" aria-disabled="true">Previous</a>
					</li>

					<li class="page-item"
						th:classappend="${page == reservations.pageable.pageNumber + 1} ? 'active'"
						th:each="page : ${#numbers.sequence(startPage, endPage)}"><a
						class="page-link"
						th:href="@{/admin/reservationMng(page=${page-1})}" th:text=${page}
						aria-current="page">1</a></li>

					<li class="page-item"
						th:classappend="${endPage == reservations.pageable.pageNumber + 1} ? 'disabled'">
						<a class="page-link"
						th:href="@{/admin/reservationMng(page=${reservations.pageable.pageNumber + 1})}">Next</a>
					</li>

				</ul>

			</div>
		</section>
	</div>

	<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
	<script type="text/javascript" src="https://cdn.iamport.kr/js/iamport.payment-1.2.0.js"></script>
</div>
</html>
